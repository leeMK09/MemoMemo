## 메시지 소비시 고려사항 

- 메시지 소비자는 다음 2가지 이유로 메시지를 중복해서 처리할 수 있다 
	- 메시지 생산자가 같은 데이터를 가진 메시지를 메시징 시스템에 두 번 전송 
	- 소비자가 메시지를 처리하는 과정에서 오류가 발생해서 메시지 재수신 
- 수신자 입장에서 동일 데이터를 가진 중복 메시지를 처리하는 방법은 메시지에 고유한 ID 를 부여해서 이미 처리했는지 여부를 추적하는 것이다 
- 이를 통해 이미 처리한 메시지는 다시 처리하지 않고 무시할 수 있다 
- 메시지 재수신이 가능한 경우 소비자가 메시지를 처리하는 과정에서 오류가 발생하면 재처리를 위한 메시지를 다시 수신할 수 있다 
	- 메시지 처리를 위한 외부 API 를 호출했는데 읽기 타임아웃이 발생할 수 있다 → 외부 API 를 호출했을 때 읽기 타임아웃이 발생하면 성공했을 가능성이 있다 
	- 실제로 성공했다면 수신자는 외부 API 를 중복해서 두 번 호출하게 된다 
	- 메시지 재수신시에 따른 중복 처리를 대응하는 방법은 **멱등성을 갖도록 API 를 구현하는 것이다**
		- API 가 멱등성을 가지면 동일 요청을 여러 번 해도 결과가 바뀌지 않는다 
- 중복 메시지 처리와 함께 메시지 소비자를 구현할 때 고려할 점은 메시지를 잘 소비하고 있는지 모니터링하는 것 이다 
	- 메시지 소비자의 처리 속도가 갑자기 느려지면 큐에 메시지가 계속 쌓이게 된다 
	- 메시징 시스템에 따라 큐가 가득 차면 생산자가 메시지를 큐에 넣지 못하게 막는 상황도 발생할 수 있다 
	- 소비자의 성능 저하가 생산자까지 영향을 줄 수 있는 것 이다 