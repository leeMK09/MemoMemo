## 성능 테스트 설계 시 고려사항

- 시스템의 트래픽 패턴
- 동시 요청 사용자 수 / 트래픽 규모
- 기능별 요청 비율
- 데이터 크기
- 워밍업
- 적절한 목표치 설정

</br>
</br>

### 성능 테스트 설계 시 실제 서비스의 목적에 맞게 설계해야 한다

- 예를들어 콜센터 업무 시스템은 업무 시작 시간부터 종료 시간까지 비교적 고른 트래픽 패턴을 보인다
- 반면 학원 관련 서비스는 주중 오후 시간대에 트래픽이 급증하는 패턴을 보인다
- 트래픽이 짧은 시간에 증가하는 패턴을 보인다면 그에 맞춰 성능 테스트도 짧은 시간 간격으로 부하를 늘리는 방식으로 설계한다
- 업무 시스템은 부하가 점진적으로 증가하기보다는 특정 시간에 목표로 하는 부하가 발생하므로 해당 부하를 바로 발생하도록 성능 테스트를 설계한다

</br>
</br>

### 동시에 사용자 규모도 고려해야 한다

- 50명이 사용하는 내부 시스템과 1천만이 사용하는 온라인 서비스는 처리해야 하는 트래픽 규모가 다르다
- 부하에 사용할 사용자 수도 중요하다
- 예를들어 한 사용자의 인증 토큰을 사용해서 모든 요청을 생성한다면 시스템은 실제보다 더 좋은 성능을 낼 수 있다
  - 예를들어 DB가 자주 조회하는 데이터를 캐싱해서 조회 속도가 빨라질 수 있다
- 사용자에 따라 조회하는 데이터가 다르다면 목표로 하는 사용자 수에 맞춰 요청을 발생시킬 수 있도록 테스트를 설계해야한다

</br>
</br>

### 부하 테스트를 설계할 때는 기능별 트래픽 비율도 고려해야 한다

- 자주 불리는 API 목록을 추리고 최대한 실제 호출되는 비율에 맞게 부하가 발생하도록 테스트를 설계한다
- 실제 불리는 비율을 고려하지 않고 1개 API 에 대해서만 부하를 발생하면 (캐시 효과와 같은 이유로) 결과가 실제보다 더 잘 나올 수 있다

</br>
</br>

### 데이터 크기도 고려해야 한다

- 데이터가 100만 건이 예상되는 서비스에 대해 부하 테스트를 하는데 DB 에 데이터를 50건만 넣으면 의미가 없다
  - 데이터 규모가 작으면 성능이 잘 나오기 때문이다
- 예상되는 규모에 맞게 테스트 데이터를 만들어야 실제로 근접한 성능 테스트 결과를 얻을 수 있다

</br>
</br>

### 테스트를 진행하기 앞서 워밍업이 필요할 때도 있다

- 캐시를 사용하는 서비스를 생각해보면 최초에 캐시에 아무 데이터도 존재하지 않으면 초기 요청은 캐시에 데이터가 없으므로 전반적으로 성능(처리량과 응답 시간)이 떨어질 것 이다
- 반면에 캐시에 어느 정도 데이터가 차기 시작하면 성능도 함께 좋아진다
- 부하 테스트의 목적이 트래픽이 몰리는 상황에서 캐시를 비울 때 어느 정도 성능이 나오는지 확인하기 위한 것이 아니라면 캐시가 어느정도 찬 다음에 부하 테스트를 진행해야 올바른 결과를 얻을 수 있다
  - 이런 테스트를 진행할 때는 진행하기에 앞서 캐시에 데이터를 어느 정도 채워 넣어야 한다

</br>
</br>

### 적절한 목표치도 중요하다

- 최고의 성능을 내는 서버를 만들겠다는 의지를 담아 처리량 목표치를 10만 TPS 로 잡을 수 있는 경우도 있다
- 이는 비현실적인 수치이며 10만 TPS 는 10만 명의 사용자가 1초마다 계속 클릭해야 발생할 수 있는 트래픽 규모이다
- 실제 예상되는 사용자 수와 요청 건수를 감안해서 성능 목표치를 설정하자
