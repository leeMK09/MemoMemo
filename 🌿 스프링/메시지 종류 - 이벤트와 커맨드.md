## 메시지 종류 - 이벤트와 커맨드 

- 메시지에는 크게 2종류가 있다 
- 하나는 이벤트(event) 이고 다른 하나는 커맨드 (command) 이다 

</br>

**이벤트 메시지와 커맨드 메시지**

- 이벤트 메시지 예시
	- 주문함, 로그인에 실패함, 상품 정보를 조회함, 배송을 완료함 
- 커맨드 메시지
	- 포인트 지급하기, 로그인 차단하기, 배송 완료 문자 발송하기 

</br>
</br>

## 이벤트 메시지 

이벤트는 **어떤 일이 발생했음을 알려주는 메시지**이다 

"주문함" 이벤트는 주문이 생성되었다는 사실을 의미하고, "배송을 완료함" 이벤트는 물건이 고객에게 전달되었다는 사실을 의미한다 

또한 이벤트는 데이터 상태 변경과 관련이 있다 

"주문함" 이벤트는 새로운 주문이 생성되었을 때 발생하고 "배송을 완료함" 이벤트는 물건 상태가 "배송 중" 에서 "배송완료" 로 바뀌었을 때 발생한다 

"로그인에 실패함" 이벤트나 "상품 정보를 조회함" 이벤트처럼 어떤 활동이 일어났다는 사실을 나타내는 경우도 있다 → 즉, 사용자의 상태는 그대로일 수 있다. 하지만 사용자의 활동 결과로 "로그인에 실패함" 이벤트는 발생한다

(이벤트 이지만 데이터 상태는 그대로)

</br>
</br>

## 커맨드 메시지 

커맨드는 **무언가를 요청하는 메시지**이다 

커맨드 메시지를 수신하는 소비자는 메시지로 요구한 기능을 실행한다 

예를들어 "포인트 지급하기" 메시지를 받은 소비자는 포인트를 지급한다 

"배송 완료 문자 발송하기" 메시지를 받은 소비자는 대상자에게 배송이 완료되었다는 문자를 발송한다 

**커맨드 메시지는 메시지를 수신할 측의 기능 실행에 초점이 맞춰져 있다 → 즉 수신자가 정해져 있다**

**반면 이벤트 메시지는 정해진 수신자는 없다**

→ 발생한 사건에 관심이 있는 소비자가 메시지를 수신하는 방식이다 

→ 따라서 배송 완료 문자 같은 이벤트 메시지를 보낸 후 문자를 보낼지 여부는 수신한 소비자 쪽에서 결정한다 

</br>

**이벤트 메시지는 소비자 확장에 적합하다**

- 예를들어 배송을 완료했을 때 문자를 발송하고 주문 상태도 변경하고 싶다면 "배송완료함" 메시지를 주문 서비스가 수신하도록 구성하면 된다 

</br>

> 궁극적 일관성 (eventual consistency)
>
> 비동기 연동을 설명할 때 자주 등장하는 용어 중 하나가 궁극적 일관성 (eventual consistency) 이다 
> 궁극적 일관성, 최종적 일관성은 일관성 모델 중 하나로, 주로 분산 시스테에서 데이터 복제를 다룰 때 사용한다 
> 이 모델은 두 데이터 저장소 간의 일관성을 보장하긴 하지만, 즉시가 아닌 일정 시간이 지난 후에야 일관성을 맞춰진다는 특성을 가진다 
> 즉, 일시적으로 두 저장소 간에 데이터 불일치가 발생할 수 있다는 뜻 이다 
>
> 비동기 메시징 방식도 이 궁극적 일관성과 유사한 특징을 갖는다 
> → 배송 서비스에서 배송 상태를 완료로 변경하더라도, 해당 변경 내용이 메시지를 통해 주문 서비스로 전달되기 전까지는 주문 서비스의 상태는 여전히 배송 중일 수 있다 
> 이처럼 배송 완료 메시지가 전파되기 전까지는 두 시스템 간의 상태가 서로 불일치할 수 있다 