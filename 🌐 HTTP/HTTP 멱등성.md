HTTP 멱등성이란 하나의 요청이 아닌 여러번 동일한 요청을 보냈을때 서버가 같은 상태를 가지는 것을 멱등성이라고 한다

</br>
</br>

## HTTP 멱등성을 가지는 메서드

- HTTP 메서드 중 멱등성을 가지는 메서드는 대표적으로 GET, HEAD, OPTIONS, PUT, DELETE 가 있다

</br>

**GET**

- 서버에서 정보를 가져오는데 사용
- 여러개의 동일한 GET 요청을 하는 것은 한번의 요청을 하는 것과 같은 효과를 갖는다
- 안전한 메서드라고도 불린다

</br>

**HEAD**

- GET 요청이 생성하는 응답의 헤더를 검색하는데 사용
- 보통 리소스 전체를 다운로드하는 오버헤드를 피하고 어떤 유형의 데이터가 반환되는지, 해당 리소스가 있는지, 수정날짜 등을 확인하기 위해 사용합니다
- GET처럼 서버 상태를 변경하지 않습니다
- 안전한 메서드라고도 불린다

</br>

**OPTIONS**

- 대상 리소스의 통신 옵션을 가져올때 사용
- 서버에서 지원하는 HTTP 메서드등을 가져온다
- 안전한 메서드라고도 불린다

</br>

**PUT**

- 리소스를 완전히 다른 버전으로 대체할때 사용
- 요청이 반복되면 동일한 리소스가 다시 대체되어 첫번째 요청 후와 동일한 상태가 된다

</br>

**DELETE**

- 리소스를 삭제하는데 사용
- 리소스가 삭제되면 삭제 작업을 반복해도 시스템 상태가 더 이상 변경되지 않는다

</br>
</br>

## HTTP 멱등성을 가지지 않는 메서드

- 대표적으로 POST, PATCH 가 있다

</br>

**POST**

- 새로운 리소스를 생성하는데 사용
- 여러 POST 요청은 여러 리소스를 생성하는 결과를 초래한다

</br>

**PATCH**

- 리소스를 부분적으로 업데이트하는데 사용
- 멱등성 여부는 PATCH 를 실행하는 방법에 따라 달라진다
- 예를들어 특정 값을 수정하는 것이라면 멱등성을 가지지만, 특정 필드의 값을 증가시키거나 해당 배열에 요소를 추가시키는 것이라면 멱등성을 가지지 않는다
- 일반적으로 해당 메서드는 멱등성을 가지지 않는다 라고 인식한다

</br>
</br>

## 멱등성을 고려한 설계

`POST` 메서드의 경우 `Idempotency Key` 를 보내서 동일한 요청인지를 식별하는 처리를 한다면,

이를 통해 동일한 작업의 재시도를 인식하고 한번만 처리되도록 어플리케이션단에서 멱등성을 유지한다

이는 중복 트랜잭션을 피해야 하는 결제처리 API 에서 자주 사용된다

```bash
POST /payments
Idempotency-Key: 6fa5438a-6818-4809a-bb15-bb8577e
```

</br>
</br>

## 멱등성이 중요한 이유

1. 일관성 - 보통 반복되는 요청이 단일 요청과 동일한 효과를 갖도록 보장하는 것은 시스템 전반에 걸쳐 일관된 상태를 유지하는데 도움이 된다
2. 유지보수성 - 멱등성을 가진 HTTP 메서드로 API 통신하면 재시도 처리를 할때 사이드 이펙트를 고려한 복잡한 로직을 구현할 필요가 없기 때문에 이부분을 잘 고려해서 설계한다면 유지보수성이 증가된다
