## 레이턴시의 구성요소

- 레이턴시는 메시지나 패킷이 출발점에서 도착점까지 이동하는데 걸리는 시간을 의미한다
- 모든 시스템은 메시지를 전송하는 데 걸리는 총 시간 안에 많은 소스와 구성요소를 포함하고 있는데 이러한 구성 요소가 무엇인지 이해하는 것이 중요하다

</br>

**전파 지연(propagation delay)**

- 메시지가 송신측(Sender)에서 수신측(Receiver)으로 이동하는데 필요한 시간, 총 이동거리 대비 신호가 이동하는 속도로 측정

</br>

**전송 지연(transmission delay)**

- 링크로 패킷의 모든 비트를 내보는 데 필요한 시간, 패킷의 길이 대비 링크의 데이터 전송 속도로 측정

</br>

**프로세싱 지연(processing delay)**

- 패킷 헤더를 처리하고 비트 수준의 에러를 체크하고 패킷의 목적지를 알아내는 데 필요한 시간

</br>

**큐잉 지연(queuing delay)**

- 패킷이 처리될 때까지 큐(queue)에서 대기하는 시간

</br>
</br>

**위 기술된 4가지 지연을 합친 것이 클라이언트와 서버 간의 총 레이턴시이다**

- 전파 지연은 신호가 이동하는 거리와 신호가 이동하는 데에 쓰이는 매체에 따라 달라진다
- 전송 지연은 전송 링크의 데이터 전송률에 좌우되며 클라이언트와 서버간의 거리와는 아무런 상관이 없다
- 패킷이 라우터에 도착하면, 라우터는 다음 발송지 루트(outgoing route)를 알아내고 데이터를 체크하기 위해 패킷 헤더를 살펴봐야 한다
  - 이 과정은 하드웨어에서 이루어진다 → 지연시간이 매우 적다
- 마지막으로 패킷이 라우터가 한 번에 처리할 수 있는 속도보다 더 빠른 속도로 도착한다면 그 패킷들은 인커밍 버퍼(incoming buffer)안에서 잠시 대기하게 된다
  - 데이터가 이 버퍼 안에서 보내는 시간이 바로 큐잉 지연이다
- 네트워크를 이동하는 각각의 패킷은 모두 이러한 지연을 겪게 된다
- 데이터의 이동 거리가 멀수록 전파 지연은 늘어나고 중단 단계에서 라우터를 만날 때마다 각 패킷은 프로세싱 지연과 전송 지연을 겪게 된다
- 트래픽이 높을 수록 패킷이 인커밍 버퍼에서 지연될 확률도 높아진다

</br>

> 로컬 라우터 안의 버퍼블롯
>
> 버퍼블롯(Bufferbloat) 이란 큐잉 지연이 네트워크 성능 전반에 영향을 끼칠 수 있다는 예시이다
> 현재 많은 라우터는 인커밍 버퍼를 가지고 있는데, 이는 패킷을 최대한 손실하지 않기 위함이다
> 그러나 이것이 TCP 의 혼잡회피 메커니즘을 오작동하게 만들어 네트워크에 크고 작은 레이턴시 지연을 야기한다
