## 점보 프레임 (Jumbo Frame)

- 점보 프레임은 네트워크 프레임의 MTU (Maximum Transmission Unit)가 기본값 1500 bytes 를 초과하는 프레임을 말한다
- AWS 에서는 일반적으로 MTU 최대 9001 bytes 까지를 점보 프레임으로 지원한다

</br>

### 점보 프레임을 사용하는 이유

**CPU 오버헤드 감소**

- MTU 가 증가하게 되면 프레임하나에 들어가는 크기가 커지고 많은 Payload 를 넣을 수 있음
- 그러므로 통신에 사용하는 패킷 수가 적어지며 이로 인해 패킷 처리 비용(인터럽트, 컨텍스트 스위칭 등)이 줄어들며 CPU 사용량이 감소

**네트워크 처리량(Throughput) 증가**

- 많은 데이터를 하나의 프레임에 담을 수 있으므로 처리량이 증가한다
- 패킷 헤더의 오버헤드가 감소하게 되고 처리량이 증가함에 따라 대역폭도 증가한다

**고대역폭 워크로드에 유리**

- BigData, 머신러닝, 스토리지 복제, 대량 데이터 동기화시 적은 수의 패킷으로 많은 데이터를 송수신할 수 있으므로 유리하다

</br>

### MTU 1500 을 넘어서 점보 프레임이 되는 기준

- 핵심 원칙은 경로(Path) 상의 모든 구간이 동일하거나 그 이상의 MTU 를 지원해야 한다
- `EC2 (MTU 9001)` → `VPC 네트워크 (MTU 9001)` → `수신받는 EC2 (MTU 9001)`
- 중간에 하나라도 1500 사이즈라면 패킷이 드롭되며 Fragmentation 이 발생하게 된다 → 성능저하 발생

</br>

### AWS 에서 점보 프레임을 사용할 수 있는 곳

**EC2 + ENA (Enhanced Networking)**

- ENA 를 사용하는 EC2 인스턴스는 점보 프레임을 지원한다
- 따로 인스턴스 OS 에서 네트워크 인터페이스 MTU 를 9001 로 설정이 필요하다

**Elastic Network Interface (ENI)**

- EC2 에 붙은 ENI 는 MTU 9001 설정이 가능하다

**AWS Direct Connect**

- 온프레미스 <-> AWS 간 고속 및 저지연 연결시 사용
- MTU 9001 지원하며 대규모 데이터 전송시 유리하다

**Amazon EKS**

- 워커 노드에서 MTU 9001 설정 시 Pod 간 통신 성능 개선

</br>

### AWS 에서 점보 프레임이 적용되지 않는 구간

- 점보 프레임은 경로 전체가 단순 전달 구조일때 가능하며 캡슐화, 암호화, 리전간의 백본을 타는 순간 MTU 1500 으로 강제된다
- VPC 내부인 경우 점보 프레임이 가능
  - 구조적인 이유: VPC 내부 통신은 AWS 의 동일 리전 내부 네트워크, ENA 기반 가상 NIC, AWS 가 직접 제어하는 L2/L3 구간이다
    - 즉 중간에 IPsec, 암호화 터널, 캡슐화 장비가 따로 없고 프레임이 거의 있는 그대로 전달되는 구조이다
    - EC2 <-> EC2 / ECS,EKS 노드 간 / ALB <-> EC2 → 같은 VPC 내부 트래픽은 점보 프레임 형성이 된다
- 동일한 리전 VPC Peering 의 경우 점보 프레임이 가능
  - 같은 Region 의 VPC Peering 은 AWS 내부 네트워크에서 직접 라우팅하며 리전 내부 백본을 벗어나지 않는다, 추가적인 터널링 및 암호화 오버헤드가 없다
- **다른 리전간의 VPC Peering 의 경우 점보 프레임은 불가능**
  - 구조적인 이유: 리전간 VPC Peering 은 AWS 글로벌 백본 네트워크를 통과하며 리전 <-> 리전 간 장거리 전송이다, 내부적으로 추가적인 캡슐화, 안정적 위주 설계를 통해 오버헤드가 존재한다
    - 해당 구간에서는 표준 Ethernet MTU (1500) 기준으로만 보장된다
    - 제한한 이유는 리전간 전송은 거리가 길며 중간 장비가 많다, 장애 영향 범위가 매우 크다 그래서 AWS 는 리전 간 안정성을 우선시하여 통신한다
- **Transit Gateway 의 경우 점보 프레임은 제한적이다**
  - Transit Gateway 는 단순한 라우터가 아닌 여러 VPC 를 허브처럼 연결하는 역할을 수행한다
  - 내부적으로 패킷 포워딩, 라우팅 테이블 적용, 경우에 따라 캡슐화를 수행한다
- **VPN 을 구성한 환경에서의 연결은 점보 프레임은 불가능하다**
  - VPN 은 기본적으로 IPsec 터널을 구성하며 패킷에 암호화 헤더, 인증 헤더, 터널 헤더가 붙어있음
  - 실제 전송 가능한 MTU 는 1500 보다 더 작아지며 AWS 는 아예 VPN MTU 인 경우 1500 으로 고정함

</br>

> Transit Gateway
>
> 다수의 VPC 와 온프레미스 네트워크를 중앙 허브 방식으로 연결해 라우팅을 단순화하는 구조 → AWS 의 관리형 네트워크 라우터
>
> TGW 가 없던 시절에는 VPC 가 늘어날수록 VPC Peering 이 거미줄처럼 증가하게 된다
>
> - VPC A <-> VPC B / VPC A <-> VPC C / VPC B <-> VCP C ...
>
> TGW 도입후 모든 VPC 가 TGW 하나에만 연결하며 Hub & Spoke 구조를 가져간다
>
> - (VPC A, VPC B, VPC C) → Transit Gateway → 온프레미스 혹은 다른 네트워크 노드
>
> 핵심 역할
>
> - 중앙 라우터 역할 수행
>   - 모든 트래픽을 중앙에서 라우팅
> - 라우팅 정책 분리
>   - TGW 는 여러개의 Route Table 을 가지며 VPC 마다 어디로 통신 가능한지를 분리할 수 있다
> - 네트워크 세그먼테이션
>   - 보안 영역 분리, 환경별 통신 제어
> - 이외에도 L3 (IP) 기반 라우팅 수행, CIDR 기반 경로 선택, 패킷 포워딩, 라우팅 테이블 전파 및 연결 관리를 수행
