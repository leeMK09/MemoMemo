## 성능 

- 기능이 얼마나 빠르게동작하는가?
- 성능이 중요한 서비스들이 있다 
    - 주식 매매 서비스 
    - 실시간 메시징 서비스 

</br>

**정의**

- "시스템이 주어진 자원 내에서 사용자 요청에 대해 빠르고 안정적으로 반응하는 특성"
- 주어진 자원 → 시스템 효율성 (주어진 자원내에서 성능개선)
- 빠르다 → 사용자가 체감할 수 있는 정도 
- 안정적 → 갑자기 부하가 많은 상황에서도 일관되도록 동작 
    - 부하가 많으면 갑자기 느려지는 서비스는 안정적이지 않음 

</br>
</br>

## 성능을 높이는 방법 

- 캐싱 
    - 자주 조회되는 데이터를 메모리에 저장해서 빠르게 응답 
    - Redis, CDN 
- 비동기 처리 
    - 오래 걸리는 작업은 기다리지 않고 따로 처리 
- DB 최적화 
    - 쿼리 최적화, 인덱스 추가, 읽기 복제본, 샤딩 등 
    - 읽기 요청은 다른 DB 를 사용하거나 Replication DB 를 사용하는 방법 
- 아키텍쳐 개선 
    - 아키텍쳐 패턴 도입 (CQRS, EDA 등)

</br>

**여기있는 방법들은 모두 트레이드 오프가 존재한다 → 트레이드 오프는 항상 존재한다**

- 캐싱 
    - 빠른 응답속도 / 그러나 DB 부하 감소 
    - 캐시 데이터와 DB 데이터 동기화 문제 
    - 캐시 무효화 로직이 필요함 / 복잡성 증가, 오래된 데이터가 사용자에게 보여질 위험이 있음 
- 비동기 처리 
    - 응답 속도 단축 / 그러나 자원 효율성 증가 
    - 순서 보장이 중요한 경우 
    - 에러 처리 로직의 복잡도 증가 

</br>
</br>

## 성능에 대한 지표 측정 방식 

- 안정적인 성능이 필요한 기능을 파악해야 한다 
- 현재 성능을 측정한 뒤 개선된 성능 지표를 비교해야 한다 
- 응답 시간 & 지연 
    - 사용자가 요청을 보낸 후 서버에서 처리하고, 응답을 받을 때까지 걸리는 전체 시간 
    - 서버에서 요청이 처리되기 전까지 기다리는 시간 
    - 최대, 최소, 평균 시간 측정 / 상위 백분위수 (p95, p99)
    - 평균(mean) 과 p99 를 비교하는 이유 
        - 평균 → 전반적인 응답 속도 경향 
        - p99 → 최악에 가까운 요청들(상위 1%)이 얼마나 느린지 
        - 이둘을 같이 비교해보면 
            - 평균은 괜찮아도 p99 가 같다 → 일부 요청이 심각하게 느리다 즉, 병목 구간 탐색이 필요 
            - 평균과 p99 가 비슷하다 → 전체가 고르게 느리다 즉, 전반적인 성능 개선이 필요 
            - 즉 극단적으로 느린 요청들이 있어서 원인을 찾아야 한다
        - 1% 를 알수있는 방법 
            - p99 를 기준으로 보면 그보다 큰 값들이 1% 구간에 해당한다 
            - 요청 1,000 개가 있을때
            - 990번째 값 = p99
            - 991 ~ 1,000 번째 요청들이 상위 1% (슬로우 요청들)
            - 즉 p99 가 1% 의 시작점을 알려주는 지표 
            - 상위 1% 의 실제 평균이나 분포를 보려면 p99 만으로는 부족하고 그 구간 데이터를 따로 분석해야 한다 
- 처리량 (Throughout) → TPS/RPS 
    - 초당 트랜잭션 수 / 총 소요시간 
    - 초당 요청 수 / 총 소요시간 
    - 부하 테스트로 처리량 확인 
- 자원 사용률 
    - CPU, 메모리, 네트워크 자원을 얼마나 효율적으로 사용하는지 
- **중요한 것은 테스트한 환경까지 같이 기록해야 한다**

</br>

**성능개선 일반적인 순서**

다시한번 강조하지만 **중요한 것은 테스트한 환경, 지금 환경등을 같이 기록해야 한다**

1. 현 시점의 성능을 지표로 분석한다 
1. 이후 어느정도를 목표로 성능을 개선할 건지 추정치를 계산 
1. 개선 방법 탐색, 테스트 결과 정리 및 기록 
1. 어떤 트레이드 오프가 생겼는지 확인

