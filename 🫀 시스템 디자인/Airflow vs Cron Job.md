## Airflow vs Cron Job

- Batch Job : 일정 주기마다 정해진 로직을 일괄 처리하는 작업
  - 예시) 매일 자정에 데이터 집계, 로그 정리 등
- Cron Job : 특정 시각/주기에 맞춰 단일 명령을 실행하는 스케줄러
  - OS 레벨에서 동작
  - `0 0 * * *` 형태로 정의

</br>

### Cron / Batch 방식의 한계

- 처음에는 Cron + Batch 스크립트로 충분해 보이지만 한계가 있다

**1. 의존성 관리의 한계**

- A → B → C 순서가 필요하면 직접 코드로 제어해야 한다
- 실패 시 재시도, 분기 처리를 직접 구현해야 한다

**2. 실패 관리가 어렵다**

- 실패 로그가 흩어져있다
- 어느 단계에서 실패했는지 한눈에 보기 어렵다

**3. 모니터링이 불편하다**

- 성공/실패 상태를 명확히 파악하기 어렵다
- 히스토리 관리가 어렵다

**4. 확장성이 낮다**

- 여러 인스턴스에서 병렬 실행하려면 구조를 설계해야 한다
- 보통 한 서버에서 실행되는 스크립트 구조에서 머무른다

</br>

## Airflow

- 위 Cron / Batch 방식의 한계를 개선한 것이 Airflow 이다
- Airflow 는 Cron / Batch 작업을 워크플로우 단위로 확장한 도구이다

**워크플로우(DAG) 기반 설계**

- 단순히 정해진 시간에 실행하는 것이 아닌 작업 간의 흐름을 코드로 명시할 수 있다

```python
task_a >> task_b >> task_c
```

- 순차 실행 / 병렬 실행 / 조건 분기 가능

**의존성 및 에러 처리를 단순화**

```python
task_a >> task_b
```

- 위 코드를 통해 A 성공시 → B 실행의 의존성을 정의할 수 있다
- 또한 A 작업 실패시 → B 작업 실행 안됨을 정의할 수 있다

```python
default_args = {
    "retries": 3,
    "retry_delay": timedelta(minutes=5)
}
```

- 재시도 및 실패 알림도 파라미터로 해결할 수 있다

**모니터링 및 시각화**

- Airflow UI 를 통해 DAG 실행 이력 / 각 Task 의 성공 및 실패 / 로그 / 재시도 횟수 등을 화면을 통해 확인할 수 있다
- 지금 어떤 배치가 어디까지 실행되었는지 눈으로 확인가능하는 것이 큰 장점이다

**확장성과 스케일링**

- Cron / Batch 는 보통 단일 서버 혹은 단일 프로세스 구조에서 동작하는 것이 일반적이다
- Airflow 는 여러 Worker / Kubernetes 기반 Pod 확장 가능 / 병렬 처리 구조에 적합하다
- 즉 대용량 배치 처리 구조에 유리하다

</br>

## Airflow 의 단점

**초기 설정과 운영 복잡도**

- 설정 및 러닝커브가 존재한다
  - Webserver
  - Scheduler
  - Executor
  - Metadata DB
  - Worker / Broker ...
- Batch 작업 대비 구성 요소가 많이 있다
- 더불어 경험자가 많이 없는 환경에서 잘못 설계할 경우 운영 난이도가 상승한다

**자원 소모**

- Airflow 의 모든 Task 는 독립된 프로세스 및 환경에 따라 별로의 컨테이너 혹은 Pod 이다
- 따라서 Task 수가 많아질수록 자원 사용이 급증하고 특히 스케줄링 시점에 부하가 몰릴 수 있다
- 가벼운 작업인 경우 Airflow 로 처리시 오히려 비효율적인 구조가 될 수 있다

**실시간 처리에 부적합**

- 모든 배치처리 도구가 그렇지만 Airflow 또한 배치 처리 도구이다
- 초 단위 이벤트 처리 및 실시간 스트리밍 처리는 적합하지 않다

**단일 실패 지점(SPOF)**

- Airflow 는 기본적으로 중앙 Scheduler / 중앙 Metadata DB 구조를 가진다
- 따라서 Scheduler 장애 혹은 DB 장애에 대한 HA 구성이 없다면 단일 장애 지점으로 안정적인 운영이 어렵다

**DAG 의존성 관리의 복잡성**

- DAG 가 많아질 수록 DAG 간 의존성 관리 / 실행 순서 / 데이터 동기화 등의 문제가 존재하며 점점 복잡해진다
- 결국 초기 DAG 설계와 품질이 매우 중요하다

**플러그인 및 버전 이슈**

- 모든 라이브러리가 그렇듯 Airflwo 는 Airflow 버전, Provider 버전, 외부 라이브러리 버전 간의 충돌이 발생할 수 있다
