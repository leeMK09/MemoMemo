## 🤔 MySQL (InnoDB) 의 플러시 리스트 란 ?

플러시 리스트 (Flush List) 는 수정된 (더티) 버퍼 풀 페이지들을 순서대로 관리하는 리스트 이다

구체적으로는

- 버퍼 풀에 올라온 데이터 페이지가 변경되면, 그 페이지는 "더티 페이지" 가 된다
- 더티 페이지는 플러시 리스트에 추가된다
- 이 리스트는 페이지의 최근 변경 시점 (LSN 순서) 대로 정렬되어 있다

### 플러시 리스트의 목적은 ?

- MySQL 이 체계적으로 더티 페이지를 디스크로 쓰기 (flush) 할 수 있도록 돕기 위함이다
  - 예를 들면
  - "버퍼 풀이 꽉 찼을 떄"
  - "트랜잭션을 커밋할 뗴"
  - "백그라운드 스레드가 주기적으로 플러시할 뗴"

즉, 디스크에 써야할 페이지를 모아둔 대기열 이라고 보면 된다

</br>

</br>

## 🤔 리두 로그 와 디스크 / 리두 로그와 데이터 페이지

트랜잭션이 어떤 데이터 페이지를 수정할 때 리두 로그에 "내가 무엇을 수정했는지" 를 먼저 기록한다.

버퍼풀의 페이지도 메모리 안에서 함께 수행된다

이때 리두 로그에는 어떤 페이지 (pageId) 를 어떤 값으로 변경했다는 식의 정보가 엔트리로 저장된다

즉, 리두 로그 엔트리는 특정 데이터 페이지와 매핑 (연결) 되어 있다
→ 나중에 복구할 때, 이 리두 로그를 따라 어떤 페이지를 어떻게 복구해야 하는지 알 수 있도록 하기 위함

**목적**

- 리두 로그는 "변경 이력" 을 기록하고, 버퍼 풀 페이지는 "변경 결과" 를 메모리에 담아둔다

따라서 변경을 하면 "리두 로그 기록" + "버퍼 풀 메모리 변경" 이 같이 일어난다

</br>

</br>

## 🤔 리두 로그에 기록이 되었다고 데이터 페이지 값을 디스크에 써진 것 인가

리두 로그 기록과 데이터 페이지 디스크 기록은 완전히 별개이다

예를 들어 어떤 트랜잭션이 완료되면서, 리두 로그에 "수정 내역"을 디스크에 반드시 기록한다 (`fsync`)

그런데 수정된 데이터 페이지 (버퍼 풀 안에 있는) 는 당장 디스크에 flush 하지 않아도 된다
→ 성능상 계속 메모리 안에서 모아두고 있다가, 나중에 한 번에 플러시 하는 경우가 많다

그래서 트랜잭션은 리두 로그만 디스크에 안전하게 남긴 상태로 커밋 완료할 수 있다
그 뒤에 서버가 죽더라도 리두 로그를 재적용해서 데이터 페이지를 복구할 수 있다

즉, 리두 로그는 트랜잭션 `durability` 를 위해 디스크에 기록하지만, 데이터 페이지는 성능을 위해 필요할 때만
디스크로 기록한다

→ 그래서 항상 더티 페이지가 디스크에 있다고 보장하지 못한다.
