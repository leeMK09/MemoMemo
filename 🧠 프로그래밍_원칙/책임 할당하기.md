### 데이터가 아닌 책임에 초점을 맞추어 설계

- GRASP 패턴
- 응집도와 결합도, 캡슐화 등

</br>

### 데이터 중심의 설계에서 책임 중심의 설계로 전환하기 위해서는 다음 두 가지 원칙을 따라야 한다

1. 데이터보다 행동을 먼저 결정해라
2. 협력이라는 문맥 안에서 책임을 결정하라

</br>
</br>

## 1. 데이터보다 행동을 먼저 결정해라

- 클라이언트 관점에서 객체가 수행하는 행동이란 곧 객체의 책임을 의미한다
- 가장 기본적인 해결방법은 객체를 설계하기 위한 질문의 순서를 바꾸는 것 !
  - "데이터 중심의 설계 질문 순서" (잘못된 방식)
    - "이 객체가 포함해야 하는 데이터가 무엇인가?"
    - "데이터를 처리하는데 필요한 오퍼레이션은 무엇인가?"
  - 반면 "책임 중심의 설계" (올바른 방식)
    - "이 객체가 수행해야 하는 책임은 무멋인가?"
    - "이 책임을 수행하는데 필요한 데이터는 무엇인가?"
    - 즉, 책임 중심의 설계에서는 객체의 행동, 책임을 먼저 결정한 후에 객체의 상태를 결정한다는 것 !

</br>
</br>

## 2. 협력이라는 문맥 안에서 책임을 결정하라

- 객체의 입장에서는 책임이 조금 어색해 보이더라도 협력에 적합하다면 그 책임은 좋은 것 !
  - 책임은 객체의 입장이 아니라 객체가 참여하는 협력에 적합해야 한다
- 협력을 시작하는 주체는 메시지 전송자이기 때문에 협력에 적합한 책임이란 메시지 수진자가 아니라 메시지 전송자에게 적합한 책임을 의미한다
  - 즉, 메시지를 전송하는 클라이언트의 의도에 적합한 책임을 할당해야 한다
  - 협력에 적합한 책임을 수확하기 위해서는 객체를 결정한 후에 메시지를 선택하는 것이 아니라 메시지를 결정한 후에 객체를 선택해야 한다 → 메시지가 존재하기 때문에 그 메시지를 처리할 객체가 필요한 것 (**메시지가 객체를 선택하게 해야 한다 !!!**)
- 메시지를 먼저 결정하기 때문에 메시지 송신자는 메시지 수신자에 대한 어떠한 가정도 할 수 없다
  - 메시지 전송자와 관점에서 메시지 수신자가 깔끔하게 캡슐화되는 것 이다

</br>
</br>

## 책임 할당을 위한 GRASP 패턴

- 크레이그 라만이 고안한 GRASP 패턴
  - General Responsibility Assignment Software Pattern (일반적인 책임 할당을 위한 소프트웨어 패턴)

</br>
</br>

## 도메인 개념에서 출발하기

- 설계를 시작하기 전에 도메인에 대한 개략적인 모습을 그려 보는 것이 유용하다
- 이 도메인 개념들을 책임 할당의 대상으로 사용하면 코드에 도메인의 모습을 투영하기가 좀 더 수월해진다
- 설계된 기획안과 기능을 토대로 대략적인 도메인 개념을 그린다 (중요)
  - 완벽할 필요는 없다, 코드를 개발하면서 코드의 구조때문이든 어드 방향에서 변경할 상황이 발생한다 (크지 않은 선에서)
  - 올바른 도메인 모델이란 존재하지 않는다

</br>
</br>

## 정보 전문가에서 책임을 할당하라

- GRASP 에서는 이를 INFORMATION EXPERT (정보 전문가) 패턴이라고 부른다
- 일단 책임 주도 설계의 발향대로 책임을 명확히 하자
  - 사용자에게 제공해야 하는 기능은 영화를 예매하는 것 (시스템으로서의 책임)
  - 이를 책임으로 간주하여 애플리케이션은 영화를 예매할 책임이 있다고 말할 수 있고 이제 이 책임을 수행하는 데 필요한 메시지를 결정해야 한다
  - 메시지는 메시지를 수신할 객체가 아니라 메시지를 전송할 객체의 의도를 반영하여 결정해야 한다
  - 따라서 첫 번째 질문은 다음과 같다.
    - "메시지를 전송할 객체는 무엇을 원하는가?"
    - 협력을 시작하는 객체는 미정이지만 이 객체가 원하는 것은 분명하다. 바로 영화를 예매하는 것이다 → 따라서 메시지의 이름으로는 "예매하라" 가 적절한 것 같다
  - 메시지를 결정했으므로 적합한 객체를 선택해야 한다
    - "메시지를 수신할 적합한 객체는 누구인가?"
    - (중요) **여기서 첫 번째 원칙! , 책임을 수행할 정보를 잘 알고있는 객체에게 책임을 할당하는 것 이다**
    - → INFORMATION EXPERT 패턴
  - 여기서 이야기하는 정보는 데이터와 다르다
    - 책임을 수행하는 객체가 정보를 "알고" 있다고 해서 그 정보를 "저장"하고 있을 필요는 없다
    - 객체는 해당 정보를 제공할 수 있는 다른 객체를 알고 있거나 필요한 정보를 계산해서 제공할 수도 있다
- ex. 예매하라 메시지에 대한 책임 할당
  - INFORMATION EXPERT 패턴에 따르면 예매하는 데 필요한 정보를 가장 많이 알고있는 객체에게 예매하라 메시지를 처리할 책임을 할당해야 한다
  - 아마 "상영 (Screen)" 이라는 도메인 개념이 적합할 것 이다
    - 예매라고 하여 뭔가 예매자(?) 를 떠올리게 했지만 정보 전문가 + 도메인 개념으로 도출된 + 캡슐화된 객체 에게 책임을 할당한다

<br>
<br>

## 높은 응집도와 낮은 결합도

- 동일한 기능을 구현할 수 있는 무수히 많은 설계 방식이 존재하지만 "높은 응집도와 낮은 결합도" 를 토대로 평가해야 한다
- GRASP 에서는 이를 "LOW COUPLING (낮은 결합도)" 패턴과 "HIGH COHESION (높은 응집도)" 패턴이라고 부른다
- ex. 할인 조건 (LOW COUPLING)
  - 현재는 Movie 에서 가격계산 (메시지 생성), 할인여부를 판단해라 라는 메시지를 던진다
  - DiscountCondition 에서 할인 여부를 판단해라 책임 할당
  - 그러나 Screening 에서 그냥 할인 여부 판단을 책임할당 해버리자 → 그러나 이 방식은 낮은 결합도를 발생하게 된다
  - Movie 는 이미 DiscountCondition 의 목록을 속성으로 가지고 있으므로 Movie 에게 책임을 넘긴다면 → 결합도를 추가하지 않고 해결이 가능하다
- ex. 할인 조건 (HIGH COHISION)
  - 그리고 높은 응집도에 따라서 만약 Screen 이 할인 조건을 갖게된다면 문제가 발생한다
  - 이유는, 할인조건이 달라진다면 Screen 도 달라져야 한다

</br>
</br>

## CREATOR 패턴

- 창조자에게 객체 생성 책임을 할당하라
- GRASP CREATOR 패턴
  - B가 A 객체를 포함하거나 참조한다
  - B가 A 객체를 기록한다
  - B가 A 객체를 긴밀하게 사용한다
  - B가 A 객체를 초기화하는 데 필요한 데이터를 가지고 있다 → B는 A에 대해 정보 전문가이다
- 위 조건에 최대한 만족한다면 B 는 A의 객체 생성 책임을 할당받아야 한다

</br>

### POLYMORPHISM, PROTECTED VARIATIONS 패턴

- 다형성 패턴
  - ex) DiscountCondition (할인 조건)
    - SequenceCondition, PeriodCondition 등으로 다형성을 형성하자
- Protected Variation 패턴
  - Movie 를 다형성으로 처리하자
  - 예시) AmountDiscountMovie, PercentDiscountMovie, NoneDiscountMovie
