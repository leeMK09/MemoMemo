## 핵심 분석 루프

- 디버깅에 활용할 수 있는 문제 파악 접근법, 시스템 이상 현상 발견 시 문제의 원인을 좁혀 가는 사고 절차
- 데이터를 기반으로 가설을 세우고 검증하고 반박하는 과정을 반복하면서 점진적으로 원인을 특정 → 이 반복 과정 전체가 분석 루프

**핵심 분석 루프 사용**

- 디버깅의 시작은 무언가 잘못되었다는 것을 인지한 시점부터 시작된다
    - 관찰 가능성에서 사용할 수 있는 임계치 알람
    - 고객의 항의("뭔가 너무 느리다")
- 원격 측정 정보를 이용하여 먼저 가설을 세우고 데이터를 통해 가설을 검증하거나 무효화 한 뒤 복잡한 문제에 대한 해답을 찾을 수 있다
- **먼저 무엇을 파악하려는 것 인가?**
    - 고객이나 알림이 이야기하고 있는 것이 무엇인가? 등 조사를 시작하게 된 계기에서 시작
- **관련있는 성능 관점의 비정상 동작을 찾아내기 위해 원격 측정 데이터 시각화**
- **지금까지 알게 된 내용들이 모두 사실인지 검증, 눈에 띄는 변화 식별**
- **이벤트의 서로 다른 속성을 그룹화하거나 필터링해 비정상 동작이 발견된 영역 내에서 공통된 디멘션 검색**
- **성능 변화를 일으킨 디멘션을 찾기**
    - 변화가 발생한 영역의 샘플 분석
    - 패턴을 찾기 위해 여러 디멘션에 대해 데이터를 나누기
    - 눈에 띄는 데이터를 발견하기 위해 특정한 디멘션이나 값으로 필터링
- **아직 파악되지 않았다면 잠재적 원인이 있을 높은 디멘션을 격리/필터링 하여 다시 처음부터 반복**

> 디멘션
>
> - 시스템에서 발생하는 데이터를 분류 및 구분, 분석하기 위한 속성 (attribute)
> - 관측 플랫폼(예시: Prometheus, OpenTelemetry Collector 등)이 단순히 숫자 값만 저장하는 것이 아닌 값과 함께 그 값을 설명하는 맥락 정보를 같이 저장
> - 이때 그 맥락을 구성하는 각각의 속성 항목이 바로 디멘션
> - service_name, region, method, status_code 등

**예시**

- 장애가 발생했을 때 관측 시스템이나 로그 시스템이 먼저 이상 징후를 시각화
- 요청 지연 시간이 갑자기 증가했다는 메트릭을 관측
- 이 시점에서 개발자는 DB 가 느려졌는가? 라는 가설을 세움
- 그리고 해당 가설을 검증하기 위해 DB 쿼리 지연 시간 메트릭을 확인, 만약 DB 는 정상이라면 해당 가설은 기각
- 이후 개발자는 새로운 가설을 세움, 외부 API 가 느려졌나? 라고 생각하고 트레이스를 확인
- 이런 식으로 관측 → 가설 → 검증 → 수정된 가설 이라는 흐름의 반복
